<!DOCTYPE html>
<html lang="en" class="h-100" data-bs-theme="auto">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" crossorigin="anonymous">

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Open+Sans:wght@300;500;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@docsearch/css@3">
    <link rel="stylesheet" href="./assets/css/index.css">
    <title>CAMPUSCOIN</title>
    <script type="module" src="./assets/js/login.js"></script>
</head>

<body class="text-center h-100 vh-100">

    <div class="cover-container d-flex w-100 h-100 p-3 mx-auto flex-column">
        <header class="mb-3">
            <h3 class="logo">CAMPUSCOIN</h3>
            <nav class="nav nav-masthead justify-content-end">
                <button type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#ModalForm"
                    id="modal-button"><a href="./quiz.html">Quiz</a></button>
            </nav>
        </header>
        <main class="main-content pt-auto" style="margin-top: 200px;">
            <div class="lead-component mt-3 align-items-center justify-content-center">
                <span class="fs-4">
                    <h2>CAMPUSCOIN</h2>
                </span>
                <p class="lead" id="parag">A CAMPUSCOIN nasceu da necessidade de transformar a vida de pessoas comuns.
                    Por isso, nossa jornada é te auxiliar no trajeto de seus sonhos. Venha conosco e dê um boost na sua
                    vida financeira
                </p>
                <p class="lead"><a class="btn btn-primary btn-lg" id="button">Explorar</a></p>
            </div>

            <!-- Modal Form -->
            <div class="modal fade" id="ModalForm" tabindex="-1" aria-hidden="true">
                <div class="modal-dialog modal-dialog-centered">
                    <div class="modal-content">
                        <!-- Login Form -->
                        <form method="post" id="login-form">
                            <div class="modal-header">
                                <h5 class="modal-title">Login</h5>
                                <button type="button" class="btn-close" data-bs-dismiss="modal"
                                    aria-label="Close"></button>
                            </div>
                            <div class="modal-body">
                                <div class="mb-3">
                                    <label for="Usuario">Usuario<span class="text-danger">*</span></label>
                                    <input type="text" name="usuario" class="form-control" id="username"
                                        placeholder="Insira um usuario">
                                </div>

                                <div class="mb-3">
                                    <label for="Senha">Senha<span class="text-danger">*</span></label>
                                    <input type="Senha" name="senha" class="form-control" id="password"
                                        placeholder="Insira uma senha">
                                </div>
                                <div class="mb-3">
                                    <input class="form-check-input" type="checkbox" value="" id="remember" required>
                                    <label class="form-check-label" for="remember">Lembrar de mim</label>
                                </div>
                            </div>
                            <div class="modal-footer pt-4">
                                <button type="button" class="btn btn-primary mx-auto w-100" id="login-button">Login
                                </button>
                            </div>
                            <p class="text-center">Ainda não tem uma conta, <button class="btn-link" type="button"
                                    data-bs-toggle="modal" data-bs-target="#CadastroForm" id="modal-button"><a href="#"
                                        id="cadastro">Cadastre-se</a></button>
                            </p>
                        </form>



                    </div>
                </div>
            </div>
            <div class="modal fade" id="CadastroForm" tabindex="-1" aria-hidden="true">
                <div class="modal-dialog modal-dialog-centered">
                    <div class="modal-content">
                        <!-- Login Form -->
                        <form method="post" id="cadastro-form">
                            <div class="modal-header">
                                <h5 class="modal-title">Cadastre-se na PROKNOW</h5>
                                <button type="button" class="btn-close" data-bs-dismiss="modal"
                                    aria-label="Close"></button>
                            </div>
                            <div class="modal-body">

                                <div class="etapa etapa1">
                                    <div class="mb-3">
                                        <label for="Usuario">Usuario<span class="text-danger">*</span></label>
                                        <input type="text" name="usuario" class="form-control" id="newUsername"
                                            placeholder="Insira um usuario">
                                    </div>
                                    <div class="mb-3">
                                        <label for="Nome">Nome completo<span class="text-danger">*</span></label>
                                        <input type="text" name="nome" class="form-control" id="nome"
                                            placeholder="Insira seu nome completo">
                                    </div>
                                    <div class="mb-3">
                                        <label for="Nome">Email<span class="text-danger">*</span></label>
                                        <input type="text" name="email" class="form-control" id="email"
                                            placeholder="Insira seu email">
                                    </div>

                                    <div class="mb-3">
                                        <label for="Senha">Senha<span class="text-danger">*</span></label>
                                        <input type="Senha" name="senha" class="form-control" id="newPassword"
                                            placeholder="Insira uma senha">
                                    </div>
                                    <div class="mb-3">
                                        <label for="Senha">Confirme sua senha<span class="text-danger">*</span></label>
                                        <input type="Senha" name="senha" class="form-control"
                                            id="newPasswordConfirmation" placeholder="Confirme sua senha">
                                    </div>

                                </div>

                                <div class="etapa etapa2" style="display: none;">
                                    <div class="mb-3">
                                        <label for="currency" class="form-label">Informe seu salário liquido<span
                                                class="text-danger">*</span></label>
                                        <input type="text" class="form-control" id="currency"
                                            oninput="formatarMoeda(this)" placeholder="Insira aqui seu salário!"
                                            value="" required>
                                        <div class="invalid-feedback">
                                            Por favor, insira seu salário!
                                        </div>
                                    </div>
                                    <div class="mb-3">
                                        <label for="bonus" class="form-label">Informe quaisquer bônus
                                            mensal<span class="text-danger">*</span></label>
                                        <input type="text" class="form-control" id="bonus" oninput="formatarMoeda(this)"
                                            placeholder="Insira aqui seus bônus!" value="" required>
                                        <div class="invalid-feedback">
                                            Por favor, insira seus bonus!
                                        </div>
                                    </div>
                                    <div class="mb-3">
                                        <label for="ativos" class="form-label">Você possui algum tipo de
                                            investimento?<span class="text-danger">*</span></label>
                                        <select class="form-select" id="ativos" required>
                                            <option value="">Escolha uma opção</option>
                                            <option>Sim</option>
                                            <option>Não</option>
                                        </select>
                                    </div>
                                    <form class="needs-validation" novalidate>
                                        <div class="row g-3 mb-2 my-3" id="campoAdicional" style="display: none;">
                                            <div class="col-md-10">
                                                <label for="ganhos" class="form-label">Insira os ganhos provenientes
                                                    destes
                                                    investimentos<span class="text-danger">*</span></label>
                                                <input type="text" class="form-control" id="ganhos"
                                                    oninput="formatarMoeda(this)" placeholder="Insira aqui seus ganhos"
                                                    value="" required>
                                                <div class="invalid-feedback">
                                                    Por favor, insira seus ganhos!
                                                </div>
                                            </div>
                                        </div>
                                    </form>
                                </div>
                                <div class="etapa etapa3" style="display: none;">
                                    <div class="mb-3">
                                        <label for="fixas" class="form-label">Informe suas despesas fixas<span
                                                class="text-danger">*</span></label>
                                        <input type="text" class="form-control" id="fixas" oninput="formatarMoeda(this)"
                                            placeholder="Insira aqui suas despesas" value="" required>
                                        <div class="invalid-feedback">
                                            Por favor, insira suas despesas fixas!
                                        </div>
                                    </div>
                                    <div class="mb-3">
                                        <label for="variados" class="form-label">Informe seus gastos variados<span
                                                class="text-danger">*</span></label>
                                        <input type="text" class="form-control" id="variados"
                                            oninput="formatarMoeda(this)"
                                            placeholder="Insira aqui seus gastos variados!" value="" required>
                                        <div class="invalid-feedback">
                                            Por favor, insira seus gastos variados!
                                        </div>
                                    </div>
                                    <div class="mb-3">
                                        <label for="lazer" class="form-label">Informe quanto gasta com lazer<span
                                                class="text-danger">*</span></label>
                                        <input type="text" class="form-control" id="lazer" oninput="formatarMoeda(this)"
                                            placeholder="Insira aqui seus gastos com lazer!" value="" required>
                                        <div class="invalid-feedback">
                                            Por favor, insira seus gastos com lazer!
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="button-login">
                                <button type="button" class="btn btn-primary mb-3 mx-auto w-80"
                                    id="cadastro-button">Cadastrar
                                </button>
                                <button type="button" class="btn btn-primary mb-3 mx-auto w-80"
                                    id="avancar-button">Avancar
                                </button>
                            </div>
                    </div>
                    </form>
                </div>
            </div>
    </div>

    </main>

    <footer class="text-dark-50">
        <p>TIAW - <a target="_blank"
                href="https://github.com/marcomartinelli2/CampusCoin"
                class="text-dark">CAMPUSCOIN Alternativas</a></p>
    </footer>
    </div>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-C6RzsynM9kWDrMNeT87bh95OGNyZPhcTNXj1NW7RuBCsyN/o0jlpcV8Qyq46cDfL"
        crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <script src="./assets/js/login.js"></script>
    <script src="./assets/js/user_info.js"></script>
    <script>




    </script>
    <script>

        const cadastroButton = document.getElementById('cadastro-button');
        const avancarButton = document.getElementById('avancar-button');

        const username = document.getElementById("newUsername").value.trim();
        const name = document.getElementById("nome").value.trim();
        const email = document.getElementById("email").value.trim();
        const password = document.getElementById("newPassword").value.trim();
        const passwordConfirmation = document.getElementById("newPasswordConfirmation").value.trim();

        const salario = document.getElementById('currency').value; // Valor do campo "salario"
        const bonus = document.getElementById('bonus').value;
        const invest = document.getElementById('ativos').value // Valor do campo "bonus"
        const ativos = document.getElementById('ganhos').value;
        const campoAdicional = document.getElementById('campoAdicional');



        let etapaAtual = 1;

        async function processaFormLogin(event) {

            event.preventDefault();

            // Captura dos valores dos campos de texto
            let username = document.getElementById("username").value.trim();
            let password = document.getElementById("password").value.trim();

            // Verifica se ambos os campos estão preenchidos
            if (username.length === 0 || password.length === 0) {
                alert('Por favor, preencha ambos os campos de usuário e senha.');
                return;
            }

            let user = await login(username, password);

            if (user) {
                console.log("finalmente caralho", user);
            } else {
                alert('Usuário ou senha incorretos');
            }
        }

        document.addEventListener('DOMContentLoaded', function () {

            cadastroButton.style.display = 'none';
            avancarButton.style.display = 'block';

            console.log('etapa:', etapaAtual);


            function avancaEtapa() {

                const etapaAtualElement = document.querySelector(`.etapa${etapaAtual}`);
                etapaAtualElement.style.display = 'none';

                etapaAtual++;

                if (etapaAtual < 3) {
                    cadastroButton.style.display = 'none';
                    avancarButton.style.display = 'block';
                } else {
                    cadastroButton.style.display = 'block';
                    avancarButton.style.display = 'none';
                }

                console.log('etapa pos ++', etapaAtual);
                if (etapaAtual > 3) {

                    $('#CadastroForm').modal('hide');
                    return;
                }

                const proximaEtapaElement = document.querySelector(`.etapa${etapaAtual}`);
                proximaEtapaElement.style.display = 'block';

            }
            avancarButton.addEventListener('click', avancaEtapa);
        });

        function createIncoming(salario, bonus, invest, ativos) {

            let objIncoming = {
                salarios: salario,
                bonus: bonus,
                hasInvestments: invest === 'Sim' ? true : false,
                investments: invest === 'Sim' ? ativos : null
            }

            return objIncoming;
        }

        function createExpenses(fixas, variados, lazer) {

            let objExpenses = {
                "fixas": fixas,
                "variados": variados,
                "lazer": lazer,
            }

            return objExpenses;
        }

        function createUser(username, password, name, email, salario, bonus, invest, ativos, fixas, variados, lazer) {

            let user = {
                "login": username,
                "senha": password,
                "nome": name,
                "email": email,
                "incomings": createIncoming(salario, bonus, invest, ativos),
                "expenses": createExpenses(fixas, variados, lazer)
            }


            return user;
        }

        async function postUser() {

            const username = document.getElementById("newUsername").value.trim();
            const name = document.getElementById("nome").value.trim();
            const email = document.getElementById("email").value.trim();
            const password = document.getElementById("newPassword").value.trim();
            const passwordConfirmation = document.getElementById("newPasswordConfirmation").value.trim();

            const salario = document.getElementById('currency').value.trim();
            const bonus = document.getElementById('bonus').value.trim();
            const invest = document.getElementById('ativos').value.trim();
            const ativos = document.getElementById('ganhos').value.trim();

            const fixas = document.getElementById('fixas').value;
            const variados = document.getElementById('variados').value;
            const lazer = document.getElementById('lazer').value;

            let user = createUser(username, password, name, email, salario, bonus, invest, ativos, fixas, variados, lazer);

            if (username.length === 0 || password.length === 0 || passwordConfirmation.length === 0 || nome.length === 0 || email.length === 0) {
                alert('Por favor, preencha todos os campos.');
                return;
            }

            if (password !== passwordConfirmation) {
                alert('As senhas não coincidem.');
                return;
            }

            try {
                const response = await fetch(apiPath, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(user)
                });

                const data = await response.json();

                if (data) {
                    alert('Usuário cadastrado com sucesso!');
                    $('#CadastroForm').modal('hide');
                    window.location = './pages/dashboard.html';
                }

            } catch (error) {
                console.error('Erro ao cadastrar usuário: ', error);
                alert('Ocorreu um erro ao processar a requisição.');
            }
        }


        document.getElementById("cadastro-button").addEventListener("click", postUser);

        document.getElementById("login-button").addEventListener("click", processaFormLogin);


    </script>

<script>
    const hasInvestments = document.getElementById('ativos');

    hasInvestments.addEventListener('change', function () {
        if (hasInvestments.value == 'Sim') {
            campoAdicional.style.display = 'block';
        } else {
            campoAdicional.style.display = 'none';
        }
    })

    const currency = document.querySelector("#currency");

    const formatter = new Intl.NumberFormat('pt-BR', {
        style: 'currency',
        currency: 'BRL',
        minimumFractionDigits: 2,
    });

    function formatarMoeda(input) {
        let valor = input.value.replace(/\D/g, '');

        input.value = formatter.format(valor / 100);
    }
</script>

</body>

</html>